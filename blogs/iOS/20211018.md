---
title: 抖音二进制重排为什么能提升启动速度？
date: 2021-10-18
tags:
  - 计算机基础
categories:
  - iOS
---

二进制重排就是通过更改符号的链接顺序，将启动时所执行的函数统一放到前面来链接，避免启动加载时出现 PageFault（缺页中断），从而提高启动速度。

<!-- more -->

---

要理解 PageFault，首先要了解页映射
::: tip

- 我们都知道，程序经过编译链接后，每个符号都绑定了虚拟内存地址，按照偏移量分布在可执行文件中，在运行时才会去分配物理内存。<br>
- **而页映射就是虚拟地址页与物理地址页的映射**，程序只能通过映射表来访问物理地址，这样进程之间就彻底隔离开了。<br>
- 但页映射并不是一下子就把所有符号都装入内存，而是**以“页（Page）”为单位划分成若干页（64 位处理器每一页是 8192 字节）**，以后加载和操作的单位就是页。<br>
- **如果当前 Page 不在内存中，加载时就会出现 PageFault**，届时系统会暂停进程，根据可执行文件中的偏移量，分配一个物理页面，并建立映射关系，然后把控制权重新交给进程。
  :::

<img :src="$withBase('/page.jpeg')" alt="mixureSecure" height="400px">

---

程序启动时，会先加载内存页，正常情况下，符号链接的顺序是按照编译顺序来执行的，那么启动时所执行的函数可能存在 N 个 Page 中，进而触发 N 个 PageFault，增加了启动时间。<br>
而二进制重排就是把启动时执行的函数放在前面链接，那么这些函数就集中在前面几个 Page 中，出现 PageFault 次数大大减少，从而缩减了启动时间。
