---
title: 理解小程序
date: 2021-11-15
tags:
  - 小程序
categories:
  - frontEnd
---

小程序本质是 Hybrid App（混合 App），渲染层走的 webView，逻辑层走 JSCore(V8,JavascriptCore)，两个线程的通信由原生做中转。

<!-- more -->

### 架构图

![小程序架构](https://pic1.zhimg.com/v2-577d754f01920923e08ab03f3e43f5f0_r.jpg)

### 小程序启动

- 冷启动：如果用户首次打开（届时会先下载小程序包），或小程序销毁后再被打开，此时小程序会重新加载启动，即冷启动。
- 热启动：如果用户已经打开过某个小程序，30 分钟之内再次打开，不会重新加载，只是从后台切换到前台，即热启动。

### 销毁

- 宿主 App 被杀死时，小程序自然也会被销毁。
- 当小程序进入后台被挂起超过 30 分钟，都没有进入前台，小程序会被销毁。
- 当小程序占用系统资源过高时，会被微信主动销毁。

### 更新

- 未启动时更新：微信运行时，会定期检查最近使用的小程序是否有更新，如果有则会下载更新。
- 启动更新：小程序每次冷启动都会异步检查是否有更新，如果有则会下载，但是此次仍然是旧版本。

### 为什么比普通的 H5 页面体验好

- 小程序是双线程模型，渲染层和逻辑层分两个线程执行，通过原生来通信。
- 小程序每一个页面都是一个 webview，页面栈里是一个个 webview，体验接近原生，并且可以分担单个 webview 的任务压力。
- 充分利用原生的能力，比如网络请求、缓存、授权等等，都是通过 JSBrige 调用原生来做。
